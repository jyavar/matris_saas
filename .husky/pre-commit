#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "🚀 STRATO Pre-commit Hook - Validando calidad del código..."

# 1. Sincronizar módulos
echo "📦 Sincronizando módulos..."
pnpm tsx scripts/sync-modules-index.ts

# 2. Validación de trazabilidad (BLINDAJE)
echo "🛡️ Validando blindaje de trazabilidad..."
pnpm validate-traceability

# 3. Linting y formato automático
echo "🔍 Ejecutando lint-staged..."
pnpm lint-staged

# 4. Validaciones personalizadas
echo "🔧 Ejecutando validaciones personalizadas..."
pnpm tsx scripts/pre-commit-validation.ts

# 5. Context watchdog
echo "👁️ Ejecutando context watchdog..."
pnpm tsx scripts/agents/context-watchdog.ts

echo "✅ Pre-commit hook completado exitosamente!"
